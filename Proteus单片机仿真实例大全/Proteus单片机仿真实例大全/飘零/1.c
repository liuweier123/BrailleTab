#include <reg51.h>
sbit e=0xb0;
sbit rw=0xb1;
sbit rs=0xb2;
sbit cs2=0xb3;
sbit cs1=0xb4;
sbit busy=0xa7;

char code ci[]={	0x00,0x04,0x00,0x06,0x1F,0x0FC,0x00,0x04,0x00,0x04,0x0FF,0x0F8,0x02,0x08,0x02,0x08,
					0x00,0x00,0x0FF,0x0FC,0x02,0x02,0x04,0x02,0x08,0x02,0x18,0x02,0x00,0x0E,0x00,0x00};
char code cheng[]={	0x24,0x10,0x24,0x60,0x25,0x80,0x7F,0x0FF,0x0C5,0x00,0x44,0x0C2,0x04,0x82,0x7E,0x92,
					0x42,0x92,0x42,0x92,0x42,0x0FE,0x42,0x92,0x42,0x0B2,0x0FE,0x96,0x40,0x82,0x00,0x00};
char code xu[]={	0x00,0x02,0x00,0x0C,0x3F,0x0F0,0x20,0x00,0x28,0x80,0x28,0x80,0x28,0x82,0x0AA,0x81,
					0x69,0x0FE,0x2A,0x80,0x2C,0x80,0x28,0x0A0,0x68,0x0C0,0x20,0x80,0x00,0x00,0x00,0x00};
char code you[]={	0x00,0x00,0x0F,0x0FF,0x08,0x42,0x08,0x42,0x08,0x42,0x08,0x42,0x08,0x42,0x0FF,0x0FE,
					0x08,0x42,0x08,0x42,0x08,0x42,0x08,0x42,0x08,0x42,0x1F,0x0FF,0x08,0x00,0x00,0x00};
char code piao[]={	0x5E,0x22,0x52,0x0AC,0x7E,0x0A1,0x52,0x0BF,0x7E,0x0A8,0x0D2,0x0A5,0x5E,0x22,0x00,0x04,
					0x7F,0x0F8,0x46,0x60,0x41,0x80,0x46,0x60,0x0FF,0x0FC,0x40,0x02,0x00,0x0E,0x00,0x00};
char code ling[]={	0x08,0x20,0x30,0x20,0x20,0x40,0x0AA,0x40,0x0AA,0x90,0x0AA,0x90,0x0A1,0x54,0x0FE,0x32,
					0x0A1,0x15,0x0AA,0x98,0x0AA,0x90,0x0AA,0x40,0x20,0x40,0x28,0x20,0x30,0x20,0x00,0x00};
char code bian[]={	0x04,0x44,0x0C,0x0E6,0x35,0x44,0x0C6,0x48,0x0C,0x28,0x00,0x40,0x3F,0x0FF,0x24,0x90,
					0x0A4,0x0FE,0x64,0x90,0x24,0x90,0x24,0x0FE,0x7C,0x91,0x21,0x0FF,0x00,0x80,0x00,0x00};
char code xie[]={	0x10,0x00,0x60,0x10,0x40,0x10,0x40,0x10,0x5F,0x90,0x44,0x90,0x44,0x90,0x44,0x90,
					0x44,0x90,0x44,0x0B2,0x4C,0x91,0x44,0x82,0x41,0x0FC,0x50,0x80,0x60,0x00,0x00,0x00};
char code ban[]={	0x00,0x02,0x7F,0x0FC,0x04,0x80,0x04,0x80,0x0FC,0x0FF,0x04,0x04,0x00,0x18,0x3F,0x0E2,
					0x24,0x04,0x25,0x0C8,0x24,0x30,0x44,0x68,0x0C5,0x84,0x46,0x06,0x00,0x04,0x00,0x00};
char code quan[]={	0x08,0x20,0x08,0x0C0,0x0B,0x00,0x0FF,0x0FF,0x09,0x00,0x08,0x82,0x2C,0x04,0x23,0x88,
					0x20,0x50,0x20,0x20,0x20,0x50,0x21,0x88,0x3E,0x04,0x00,0x06,0x00,0x04,0x00,0x00};
char code suo[]={	0x00,0x02,0x00,0x04,0x3F,0x0F8,0x24,0x40,0x24,0x40,0x44,0x42,0x0C7,0x0E4,0x40,0x08,
					0x3F,0x0F0,0x22,0x00,0x22,0x00,0x42,0x00,0x0C3,0x0FF,0x46,0x00,0x02,0x00,0x00,0x00};
char code you1[]={	0x20,0x20,0x20,0x40,0x20,0x80,0x21,0x00,0x27,0x0FF,0x3C,0x90,0x0E4,0x90,0x24,0x90,
					0x24,0x90,0x24,0x92,0x24,0x91,0x2F,0x0FE,0x24,0x00,0x60,0x00,0x20,0x00,0x00,0x00};
char code q1[]={0x7C,0x82,0x8A,0x84,0x7A};
char code dog1[]={0x00,0x6C,0x6C,0x00,0x00};
char code s11[]={0x00,0x42,0xFE,0x02,0x00};
char code s51[]={0xE4,0xA2,0xA2,0xA2,0x9C};
char code s91[]={0x62,0x92,0x92,0x94,0x78};
char code s81[]={0x6C,0x92,0x92,0x92,0x6C};
char code s71[]={0x80,0x8E,0x90,0xA0,0xC0};
char code s31[]={0x84,0x82,0x92,0xB2,0xCC};

void pulse()
	{
	e=1;
	e=0;
	}

void busy_check(char right)
	{
	P2=0xff;
	if (right==1)
		{
		P3=0x13;
		while(!busy);
		}
	if (right==0)
		{
		P3=0x0b;
		while(!busy);
		}
	}

void cmd_w(char cmd,char right)
	{
	busy_check(right);
	if (right==1)
		{
		P3=0x10;
		}
	if (right==0)
		{
		P3=0x08;
		P3=0x08;
		}
	P2=cmd;
	pulse();
	}

void data_w(char dat,char right)
	{
	busy_check(right);
	if (right==1)
		{
		P3=0x14;
		}
	if (right==0)
		{
		P3=0x0c;
		}
	P2=dat;
	pulse();
	}

void lcd_init()
	{
	unsigned int i;
	cmd_w(0x3e+1,0);//显示开关
	cmd_w(0xc0+0,0);//修改显示起始行
	cmd_w(0xb8+0,0);//修改页地址
	cmd_w(0x40+0,0);//修改列地址
	cmd_w(0x3e+1,1);
	cmd_w(0xc0+0,1);
	cmd_w(0xb8+0,1);
	cmd_w(0x40+0,1);
	for(i=0;i<256;i++)
		{
		data_w(0x00,0);
		}

	cmd_w(0xb8+4,0);
	cmd_w(0x40+8,0);
	for(i=0;i<256;i++)
		{
		data_w(0x00,0);
		}

	for(i=0;i<256;i++)
		{
		data_w(0x00,1);
		}

	cmd_w(0xb8+4,1);
	cmd_w(0x40+8,1);
	for(i=0;i<256;i++)
		{
		data_w(0x00,1);
		}
	}

char chang(char a)
	{
	char temp,i;
	for(i=0;i<8;i++)
		{
		temp<<=1;
		temp|=(a&0x01);
		a>>=1;
		}
	return(temp);
	}

void hanzi_w(char hang,char lie,char zhi[32])
	{
	unsigned char i;
	if(lie<4)
		{
		cmd_w(0xb8+2*hang,0);
		cmd_w(0x40+16*lie,0);
		for(i=0;i<32;i+=2)
			data_w(chang(zhi[i]),0);
		}
	else
		{
		cmd_w(0xb8+2*hang,1);
		cmd_w(0x40+16*(lie-4),1);
		for(i=0;i<32;i+=2)
			data_w(chang(zhi[i]),1);
		}
	if(lie<4)
		{
		cmd_w(0xb8+2*hang+1,0);
		cmd_w(0x40+16*lie,0);
		for(i=1;i<32;i+=2)
			data_w(chang(zhi[i]),0);
		}
	else
		{
		cmd_w(0xb8+2*hang+1,1);
		cmd_w(0x40+16*(lie-4),1);
		for(i=1;i<32;i+=2)
			data_w(chang(zhi[i]),1);
		}
	}

void zifu_w(char hang,char lie,char zhi[8])
	{
	unsigned char i;
	if(lie<8)
		{
		cmd_w(0xb8+hang,0);
		cmd_w(0x40+8*lie,0);
		for(i=0;i<5;i++)
			data_w(chang(zhi[i]),0);
		}
	else
		{
		cmd_w(0xb8+hang,1);
		cmd_w(0x40+8*(lie-8),1);
		for(i=0;i<5;i++)
			data_w(chang(zhi[i]),1);
		}
	}

void delay(unsigned char a)
	{
	unsigned char i,j;
	for(i=0;i<a;i++)
		for(j=0;j<200;j++)
			;
	}

void main()
	{
	unsigned char i;
	lcd_init();
	hanzi_w(0,0,ci);
	hanzi_w(0,1,cheng);
	hanzi_w(0,2,xu);
	hanzi_w(0,3,you);
	hanzi_w(0,4,piao);
	hanzi_w(0,5,ling);
	hanzi_w(0,6,bian);
	hanzi_w(0,7,xie);
	hanzi_w(3,2,ban);
	hanzi_w(3,3,quan);
	hanzi_w(3,4,suo);
	hanzi_w(3,5,you1);

	zifu_w(4,2,q1);
	zifu_w(4,3,q1);
	zifu_w(4,4,dog1);
	zifu_w(4,5,s11);
	zifu_w(4,6,s51);
	zifu_w(4,7,s91);
	zifu_w(4,8,s81);
	zifu_w(4,9,s71);
	zifu_w(4,10,s31);
	zifu_w(4,11,s51);
	zifu_w(4,12,s31);
	while(1)
		{
		delay(200);
		cmd_w(0xc0+i,0);
		cmd_w(0xc0+i,1);
		i++;
		if(i==64)
			i=0;
		}
	}
