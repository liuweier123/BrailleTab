C51 COMPILER V8.05a   MAIN                                                                 08/11/2007 15:39:08 PAGE 1   


C51 COMPILER V8.05a, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE source\main.c BROWSE INCDIR(.\include) DEBUG OBJECTEXTEND PRINT(.\main.lst)
                    - OBJECT(main.obj)

line level    source

   1          //*************************************************************************************************
   2          //*************************************************************************************************
   3          //**<程序名>：键盘和LCD。                                                                                                                                                **
   4          //**<功能>：有显示和键盘输入，只是一个程序框架。                                                                                                 **
   5          //**<版本说明>：这是第1.0版。                                                                                                                                    **
   6          //**<作者>：程沛                                                                                                                                                                 **
   7          //**<完成时间>：2007年8月8日                                                                                                                                     **
   8          //**<联系方式>：superyongzhe@163.com                                                                                                                     **
   9          //*************************************************************************************************
  10          //*************************************************************************************************
  11          #include "includes.h"
  12          
  13          
  14          #define TIME1H 0x3C
  15          #define TIME1L 0xB0             //定时器1溢出时间：50ms
  16          
  17          #define SCANPORT P2
  18          
  19          
  20          //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
  21          //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<防抖动标志>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
  22          //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
  23          bit b_KeyShock=0;                                       //键盘防抖动标志位。
  24                                                                                  //当按键中断产生时，首先判断此位。
  25                                                                                  //0--执行键盘扫描及键码处理程序；1--不执行。
  26          
  27          bit b_KillShock=0;                                      //防抖标志清除位：0--不清除；1--清除。
  28          
  29          unsigned char uc_KillCount=1;           //抖动标志清除计数，使用定时器1。
  30          
  31          
  32          //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
  33          //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<键盘扫描开启标志>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
  34          //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
  35          bit b_KeyScan=0;                                        //0--不扫描；
  36                                                                                  //1--扫描。
  37          
  38          
  39          
  40          void main()
  41          {
  42   1              vdInitialize();
  43   1      
  44   1              vWriteCMD(0x81);
  45   1      
  46   1              vShowChar("In Your Order !");
  47   1      
  48   1              SCANPORT=0x0F;
  49   1              
  50   1      //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<外部中断0，用于开启键盘扫描及键码处理标志>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
  51   1              IT0=1;                   //     中断方式：下降沿。
  52   1              EX0=1;                   //     开启外部中断。
  53   1      
  54   1      
C51 COMPILER V8.05a   MAIN                                                                 08/11/2007 15:39:08 PAGE 2   

  55   1      //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<定时器1，用于防抖动标志清除 >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
  56   1              TH1=TIME1H;
  57   1              TL1=TIME1L;
  58   1              TR1=1;                   //开启定时器1
  59   1              ET1=1;                   //开定时器1中断
  60   1      
  61   1      
  62   1              EA=1;
  63   1      
  64   1              while(1)
  65   1              {
  66   2              if(b_KeyScan==1)                   //如果有按键按下，则进行按键扫描和键码处理。
  67   2                      {
  68   3                      b_KeyScan=0;
  69   3                      vKeyProcess(ucKeyScan());
  70   3                      }
  71   2              }
  72   1      }
  73          
  74          //*************************************************************************************************
  75          //*                                                                                                                                                                                               *
  76          //*             ******************************外部中断0，用于开启键盘扫描及键码处理******************     *
  77          //*                                                                                                                                                                                               *
  78          //*************************************************************************************************
  79          void vINT0(void) interrupt 0
  80          {
  81   1              if(b_KeyShock==0)
  82   1                      {
  83   2                              b_KeyScan=1;                    //开启键盘扫描标志。
  84   2                              b_KeyShock=1;                   //设置防抖动标志。
  85   2                      }
  86   1              else b_KeyShock=0;                              //如果有抖动则不执行键扫描，恢复防抖动标志。
  87   1      
  88   1      //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<设置防抖动清除标志位 >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 
  89   1              if(b_KeyShock==1)
  90   1                      b_KillShock=1;                          //如果防抖动标志位开启则开启防抖动标志清除位，
  91   1                                                                              //300ms后清除防抖动标志。
  92   1      
  93   1      }
  94          
  95          
  96          //*************************************************************************************************
  97          //*                                                                                                                                                                                               *
  98          //*             ****************定时器1中断，用于计时功能和防抖动标志清除以及显示报告****************     *
  99          //*                                                                                                                                                                                               *
 100          //*************************************************************************************************
 101          void vTimer1(void) interrupt 3
 102          {
 103   1      //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
 104   1      //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<防抖动标志清除>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
 105   1      //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
 106   1              if(b_KillShock==1)
 107   1                      {
 108   2                      if(uc_KillCount==5)                      //当防抖动标志位为1时，计时300ms后清除抖动标志位。
 109   2                              {
 110   3                              b_KeyShock=0;
 111   3                              b_KillShock=0;
 112   3                              uc_KillCount=1;
 113   3                              }
 114   2                      else uc_KillCount++;
 115   2                      }
 116   1      //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
C51 COMPILER V8.05a   MAIN                                                                 08/11/2007 15:39:08 PAGE 3   

 117   1      //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<恢复定时器1溢出时间>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
 118   1      //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
 119   1              TH1=TIME1H;
 120   1              TL1=TIME1L;
 121   1      } 


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    112    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
