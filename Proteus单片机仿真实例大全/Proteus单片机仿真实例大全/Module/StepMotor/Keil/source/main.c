//*************************************************************************************************
//*************************************************************************************************
//**<程序名>：步进电机驱动																 		 **
//**<功能>：通过编程输出脉冲来控制步进电机转动。 												 **
//**<作者>：LastRitter																			 **
//**<完成时间>：2007年8月9日																	 **
//**<联系方式>：E-Mail:superyongzhe@163.com;QQ:314665354。										 **
//*************************************************************************************************
//*************************************************************************************************

//*************************************************************************************************
//*																								  *
//*			 ******************************头文件及宏定义**************************				  *
//*																								  *
//*************************************************************************************************
#include <at89x51.h>

#define TIME0H 0xFC
#define TIME0L 0x18			//定时器0溢出时间：1ms


//*************************************************************************************************
//*																								  *
//*			 ******************************全局变量*********************************			  *
//*																								  *
//*************************************************************************************************

unsigned char uc_StepSelect=0;		   //励磁电流选择序号。

unsigned int ui_ChangeCount=0;		   //改变励磁电流，定时器计数。

unsigned char uca_MotorStep[]={0x03,0x02,0x06,0x04,0x0C,0x08,0x09,0x01};
									   //励磁电流数组。


//*************************************************************************************************
//*																								  *
//*			  ********************************主函数******************************				  *
//*																								  *
//*************************************************************************************************
void main()
{

	TMOD=0x01;
	TH0=TIME0H;
	TL0=TIME0L;
	TR0=1;
	ET0=1;

	EA=1;
	
	while(1);
}


//*************************************************************************************************
//*																								  *
//*				******************************定时器0，用于电机励磁******************			  *
//*																								  *
//*************************************************************************************************
void vTimer0() interrupt 1
{
	if(ui_ChangeCount==100)						//可通过此句改变速度。
		{
		P1=uca_MotorStep[uc_StepSelect];

		if(uc_StepSelect<7)
			uc_StepSelect++;
		else 
			uc_StepSelect=0;
	
		ui_ChangeCount=0;
		}
	else
		ui_ChangeCount++;

	TH0=TIME0H;
	TL0=TIME0L;
} 