//*************************************************************************************************
//*************************************************************************************************
//**<程序名>：数码管静态串行显示及键盘扫描。													 **
//**<功能>：将键盘输入转换成相应的输出并显示在LED上。											 **
//**<作者>：LastRitter																			 **
//**<完成时间>：2007年7月31日																	 **
//**<联系方式>：E-Mail:superyongzhe@163.com;QQ:314665354。										 **
//*************************************************************************************************
//*************************************************************************************************


//*************************************************************************************************
//*																								  *
//*			 ******************************头文件及宏定义**************************				  *
//*																								  *
//*************************************************************************************************
#include "includes.h"

#define SCANPORT P2


//*************************************************************************************************
//*																								  *
//*			  ********************************全局变量******************************			  *
//*																								  *
//*************************************************************************************************
unsigned char uc_KeyShock=0;	  	//键盘防抖动标志。
									//当按键中断产生时，首先判断此位。
									//等于250时执行键盘扫描及键码处理程序。



//*************************************************************************************************
//*																								  *
//*			  ********************************主函数******************************				  *
//*																								  *
//*************************************************************************************************
void main()
{
	SCANPORT=0x0F;	//初始化键盘接口。

	SM0=0;
	SM1=0;		//串口模式：模式0.

	vShowNumber(0);		//初始化显示。
						 
	while(1)
		{
		if((P2&0x0F)!=0x0F)
			{
			if(uc_KeyShock==250)
				{
				vShowNumber(ucKeyScan());	//当判断有按键按下时扫描键盘，并把扫描结果显示在数码管上。
				uc_KeyShock=0;					//恢复防抖动标志初始值。
				}
			else uc_KeyShock++;				//如果有抖动则不执行键扫描，增加计数。
			}
		}
}

