C51 COMPILER V8.05a   KEYSCAN                                                              08/11/2007 16:54:29 PAGE 1   


C51 COMPILER V8.05a, COMPILATION OF MODULE KEYSCAN
OBJECT MODULE PLACED IN KeyScan.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE sources\KeyScan.c BROWSE INCDIR(.\include) DEBUG OBJECTEXTEND PRINT(.\KeySc
                    -an.lst) OBJECT(KeyScan.obj)

line level    source

   1          //*************************************************************************************************
   2          //*************************************************************************************************
   3          //**<程序名>：键盘扫描程序。                                                                                                                                     **
   4          //**<功能>：  当查询到有按键时，调用此程序扫描按键，并返回键码。                                                             **
   5          //*************************************************************************************************
   6          //*************************************************************************************************
   7          
   8          
   9          //*************************************************************************************************
  10          //*                                                                                                                                                                                               *
  11          //*                      ******************************头文件及宏定义**************************                           *
  12          //*                                                                                                                                                                                               *
  13          //*************************************************************************************************
  14          #include <at89x51.h>
  15          
  16          #define SCANPORT P2                               //4×4键盘扫描端口，低4位是行线，高4位是列线。
  17                                                                            //采用逐列扫描的方法，无按键时，低4位输出1，高4位输出0。
  18                                                                            //当有按键时，高4位输出扫描电位，低4位输入扫描结果。
  19          
  20          //*************************************************************************************************
  21          //*                                                                                                                                                                                               *
  22          //*                       ********************************全局变量******************************                          *
  23          //*                                                                                                                                                                                               *
  24          //*************************************************************************************************
  25          unsigned char uca_LineScan[4]={0xEF,0xDF,0xBF,0x7F};            //列线扫描电压，分为第1，2，3，4根列线
  26                                                                                                                                  //为低电平，其他为高电平。
  27          
  28          
  29          //*************************************************************************************************
  30          //*                                                                                                                                                                                               *
  31          //*                       ********************************函数实现******************************                          *
  32          //*                                                                                                                                                                                               *
  33          //*************************************************************************************************
  34          unsigned char ucKeyScan()
  35          {
  36   1              unsigned char ucTemp=0;                         //扫描状态暂存。
  37   1              unsigned char ucRow=0,ucLine=0;     //行号，列号。
  38   1      
  39   1              for(ucLine=0;ucLine<4;ucLine++)         //列扫描
  40   1                      {
  41   2                              SCANPORT=uca_LineScan[ucLine];                    //输出扫描电位。
  42   2                              ucTemp=SCANPORT&0x0F;                                     //输入扫描电位，并屏蔽高4位。
  43   2                              if(ucTemp!=0x0F)                 
  44   2                                      {                                                                         //判断该列是否有按键按下。
  45   3                                      switch(ucTemp)
  46   3                                              {
  47   4                                              case 0x0E: ucRow=10;break;                //如果有，则判断行号。
  48   4                                              case 0x0D: ucRow=20;break;
  49   4                                              case 0x0B: ucRow=30;break;
  50   4                                              case 0x07: ucRow=40;break;
  51   4                                              default:   ucRow=50;break;
  52   4                                              }
  53   3                                      break;
  54   3                                      }
C51 COMPILER V8.05a   KEYSCAN                                                              08/11/2007 16:54:29 PAGE 2   

  55   2                      }
  56   1      
  57   1              SCANPORT=0x0F;                                  //恢复扫描前状态。
  58   1      
  59   1              return ucRow+ucLine+1;                  //返回按键编码。格式为2位数，高位为行号，低位为列号。
  60   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     67    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
